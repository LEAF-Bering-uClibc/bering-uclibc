--- freenet6-1.0.orig/src/tspc.conf.in
+++ freenet6-1.0/src/tspc.conf.in
@@ -6,7 +6,6 @@
 # tsp client version
 #
 tsp_version=1.0.1
-tsp_dir=@tsp_dir@
 
 #
 # auth_method=any|supported mechanism
@@ -33,21 +32,8 @@
 # template=target
 # template tells which configuration script needs to be run for interface
 # setup.
-# Normally you only need to put your osname in the value.
 # You can also use "checktunnel" if you only want the tunnel info print out.
-# Possible templates are:
-# template=checktunnel
-# template=freebsd4
-# template=freebsd44
-# template=netbsd
-# template=openbsd
-# template=solaris8
-# template=linux
-# template=windows2000
-# template=windowsXP
-# template=windows2003
-# template=darwin
-template=@target@
+template=setup
 
 # server=FQDN:PORT  (Default port is 3653)
 # Tunnel Broker address
--- freenet6-1.0.orig/src/auth.c
+++ freenet6-1.0/src/auth.c
@@ -32,6 +32,7 @@
 #include <stdlib.h>
 #include <unistd.h>
 #include <stdarg.h>
+#include <time.h>
 #include <sys/types.h>
 #include <sys/ioctl.h>
 #include <sys/socket.h>
@@ -126,26 +127,26 @@
    int len;
 
    flags = 0;
-   *Token=*Value=NULL;
+   *Token=*Value='\0';
    for(s=e=String+11; *e; e++) {
-      if(*e== ' ' || *e == '\r' || *e == '\n' || *e==NULL) {
+      if(*e== ' ' || *e == '\r' || *e == '\n' || *e=='\0') {
         if(s!=e) {
-           if(*Token && (*Value==NULL)) {
+           if(*Token && (*Value=='\0')) {
                len = (int)((char *)e-(char *)s);
                memcpy(Value, s, len);
-               Value[len] = NULL;
+               Value[len] = '\0';
            }
            if(*Token && *Value) {
               flags += SetCapability(Token,Value); 
-              *Value = *Token = NULL;
+              *Value = *Token = '\0';
            }
          }
          s = ++e;
       }
-      if((*e=='=' || *e== ' ' || *e == '\r' || *e == '\n' || *e==NULL) && (e != s)) {
+      if((*e=='=' || *e== ' ' || *e == '\r' || *e == '\n' || *e=='\0') && (e != s)) {
          len = (int)((char *)e-(char *)s);
          memcpy(Token, s, len);
-         Token[len] = NULL;
+         Token[len] = '\0';
          s = ++e;
       }
    }
@@ -237,32 +238,32 @@
    c->algorithm = "";
    c->charset   = "";
    c->rspauth   = "";
-   *Token=*Value=NULL;
+   *Token=*Value='\0';
    for(s=e=String; ; e++) {
-      if(*e== ',' || *e == '\r' || *e == '\n' || *e==NULL) {
+      if(*e== ',' || *e == '\r' || *e == '\n' || *e=='\0') {
         if(s!=e) {
-           if(*Token && (*Value==NULL)) {
+           if(*Token && (*Value=='\0')) {
                len = (int)((char *)e-(char *)s);
                /* Chop the quotes */
                if((*s == '"') && len) { s++; len--; }
                if((s[len-1] == '"') && len) len--;
 
                if(len) memcpy(Value, s, len);
-               Value[len] = NULL;
+               Value[len] = '\0';
            }
            if(*Token && *Value) {
               InsertInChallegeStruct(c, Token,Value); 
-              *Value = *Token = NULL;
+              *Value = *Token = '\0';
            }
          }
-         if(*e == NULL) break;
+         if(*e == '\0') break;
          s = ++e;
       }
-      if((*e=='=' || *e== ',' || *e == '\r' || *e == '\n' || *e==NULL) && (*Token == NULL) && (e != s)) {
+      if((*e=='=' || *e== ',' || *e == '\r' || *e == '\n' || *e=='\0') && (*Token == '\0') && (e != s)) {
          len = (int)((char *)e-(char *)s);
          memcpy(Token, s, len);
-         Token[len] = NULL;
-         if(*e == NULL) break;
+         Token[len] = '\0';
+         if(*e == '\0') break;
          s = ++e;
       }
    }
--- freenet6-1.0.orig/src/tspc.c
+++ freenet6-1.0/src/tspc.c
@@ -54,8 +54,8 @@
 
 #define Identification "tspc - Tunnel Server Protocol Client\n"
 
-char *FileName  = "tspc.conf";
-char *LogFile   = "tspc.log";
+char *FileName  = "/etc/freenet6/tspc.conf";
+char *LogFile   = "/var/log/tspc.log";
 char *ScriptDir = NULL;
 char *LogFileName = NULL;
 tConf Conf;
@@ -73,10 +73,10 @@
    int  RootUid = 0;
 #  define ScriptExtension "bat"
 #else
-   char *TspHomeDir  = "/usr/local/etc/tsp";
+   char *TspHomeDir  = "/etc/freenet6";
    char DirSeparator = '/';
    int  RootUid = 0;
-#  define ScriptInterpretor "/bin/sh "
+#  define ScriptInterpretor ""
 #  define ScriptExtension "sh"
 #endif
 
@@ -267,10 +267,10 @@
    if(Value) {
       for(;*Value; Value++) {
          if(strchr(AllowedChars, *Value) == NULL)
-            return NULL;
+            return 0;
       }
    } else {
-      return NULL;
+      return 0;
    }
    return 1;
 }
@@ -450,15 +450,21 @@
   if(IsPresent(Conf->dns_server)) {
      char *Server;
      char *dns = strdup(Conf->dns_server);
+     int result;
+     struct addrinfo *contact;
      if (eq(Conf->host_type, "host")) {
        Display(1,ELError, "VerifyConfig", "DNS delegation is not support for host_type=host");
        status = 1;
      }
      for(Server = strtok(dns, ":");Server; Server = strtok(NULL, ":")) {
-        if(gethostbyname(Server) == NULL) {
-           Display(1,ELError, "VerifyConfig", "DNS server name %s is not resolving.", Server);
+	if( result=getaddrinfo(Server, "domain", 0, &contact)) {
+		Display(1,ELError, "VerifyConfig",
+			"DNS server name %s is not resolving.", Server);
            status = 1;
         }
+	else {
+		freeaddrinfo(contact);
+	}
      }
      free(dns);
   }
--- freenet6-1.0.orig/src/log.c
+++ freenet6-1.0/src/log.c
@@ -158,6 +158,9 @@
     fflush(Logfp);
   }
 
+  /* only syslog errors */
+  if(ErrorLevel>ELError) return 0;
+
   snprintf(str, sizeof str,  " %s: %s", FunctionName, fmt);  
 
   syslog(prio[ErrorLevel], str);
@@ -199,6 +202,9 @@
     fflush(Logfp);
   }
 
+  /* only syslog errors */
+  if(ErrorLevel>ELError) return 0;
+
   snprintf(str, sizeof str, "%s : %s", FunctionName, Format);  
 
   syslog(prio[ErrorLevel], str);
--- freenet6-1.0.orig/template/linux.sh
+++ freenet6-1.0/template/linux.sh
@@ -131,7 +131,7 @@
    Display 1 "Kernel setup"
    #Better way on linux to avoid loop with the remaining /48?
    $route -A inet6 add $TSP_PREFIX::/$TSP_PREFIXLEN dev $TSP_HOME_INTERFACE 2>/dev/null
-   Exec $sysctl -w net.ipv6.conf.all.forwarding=1 # ipv6_forwarding enabled
+   Exec $sysctl -w net.ipv6.conf.all.forwarding=1 >/dev/null   # ipv6_forwarding enabled
    Display 1 "Adding prefix to $TSP_HOME_INTERFACE"
    OLDADDR=`$ifconfig $TSP_HOME_INTERFACE | grep "inet6.* $PREF" | sed -e "s/^.*inet6 addr: //" -e "s/ Scope.*\$//"`
    if [ ! -z $OLDADDR ]; then
@@ -140,27 +140,27 @@
    fi
    Exec $ifconfig $TSP_HOME_INTERFACE add $TSP_PREFIX:1::1/64
    # Router advertisement configuration 
-   Display 1 "Create new $rtadvdconfigfile"
-   echo "##### rtadvd.conf made by TSP ####" > "$rtadvdconfigfile"
-   echo "interface $TSP_HOME_INTERFACE" >> "$rtadvdconfigfile"
-   echo "{" >> "$rtadvdconfigfile"
-   echo " AdvSendAdvert on;" >> "$rtadvdconfigfile"
-   echo " prefix $TSP_PREFIX:0001::/64" >> "$rtadvdconfigfile"
-   echo " {" >> "$rtadvdconfigfile"
-   echo " AdvOnLink on;" >> "$rtadvdconfigfile"
-   echo " AdvAutonomous on;" >> "$rtadvdconfigfile"
-   echo " };" >> "$rtadvdconfigfile"
-   echo "};" >> "$rtadvdconfigfile"
-   echo "" >> "$rtadvdconfigfile"
-   /etc/init.d/radvd stop
-   if [ -f $rtadvdconfigfile ]; then
-      KillProcess $rtadvdconfigfile
-      Exec $rtadvd -u radvd -C $rtadvdconfigfile
-      Display 1 "Starting radvd: $rtadvd -u radvd -C $rtadvdconfigfile"
-   else
-      echo "Error : file $rtadvdconfigfile not found"
-      exit 1
-   fi
+#   Display 1 "Create new $rtadvdconfigfile"
+#   echo "##### rtadvd.conf made by TSP ####" > "$rtadvdconfigfile"
+#   echo "interface $TSP_HOME_INTERFACE" >> "$rtadvdconfigfile"
+#   echo "{" >> "$rtadvdconfigfile"
+#   echo " AdvSendAdvert on;" >> "$rtadvdconfigfile"
+#   echo " prefix $TSP_PREFIX:0001::/64" >> "$rtadvdconfigfile"
+#   echo " {" >> "$rtadvdconfigfile"
+#   echo " AdvOnLink on;" >> "$rtadvdconfigfile"
+#   echo " AdvAutonomous on;" >> "$rtadvdconfigfile"
+#   echo " };" >> "$rtadvdconfigfile"
+#   echo "};" >> "$rtadvdconfigfile"
+#   echo "" >> "$rtadvdconfigfile"
+#   /etc/init.d/radvd stop
+#   if [ -f $rtadvdconfigfile ]; then
+#      KillProcess $rtadvdconfigfile
+#      Exec $rtadvd -u radvd -C $rtadvdconfigfile
+#      Display 1 "Starting radvd: $rtadvd -u radvd -C $rtadvdconfigfile"
+#   else
+#      echo "Error : file $rtadvdconfigfile not found"
+#      exit 1
+#   fi
 fi
 
 Display 1 "--- End of configuration script. ---"
--- freenet6-1.0.orig/debian/init.d
+++ freenet6-1.0/debian/init.d
@@ -0,0 +1,40 @@
+#! /bin/sh
+#
+# freenet6	Script to configure the IPv6 tunnel to freenet6
+#
+#		Written by Martin Waitz <tali@debian.org>
+
+PATH=/sbin:/bin:/usr/sbin:/usr/bin
+TSPC=/usr/sbin/tspc
+
+test -f $TSPC || exit 0
+
+
+# read tsp client config, to get the interface used
+. /etc/freenet6/tspc.conf
+IF=$if_tunnel
+
+case "$1" in
+  start)
+	echo -n "Setting up freenet6 IPv6 tunnel ($IF): "
+	$TSPC &&
+	ifconfig $IF | grep "Global" | sed -e "s/^.*inet6 addr: //" -e "s/ Scope.*\$//"
+	;;
+  stop)
+	echo -n "Shutting down freenet IPv6 tunnel ($IF): "
+	ip tunnel del $IF &&
+	echo "done."
+	;;
+  restart|force-reload)
+	echo -n "Resetting freenet IPv6 tunnel ($IF): "
+	ip tunnel del $IF 2>/dev/null
+	$TSPC &&
+	ifconfig $IF | grep "Global" | sed -e "s/^.*inet6 addr: //" -e "s/ Scope.*\$//"
+	;;
+  *)
+	echo "Usage: $0 {start|stop|restart|force-reload}" >&2
+	exit 1
+	;;
+esac
+
+exit 0
--- freenet6-1.0.orig/debian/freenet6.0freenet6.ppp.ip-down
+++ freenet6-1.0/debian/freenet6.0freenet6.ppp.ip-down
@@ -0,0 +1,4 @@
+#!/bin/sh
+# if this script gets called, we assume that the machine has lost
+# IPv4 connectivity to freenet6.net -> shut down IPv6, too
+/etc/init.d/freenet6 stop
--- freenet6-1.0.orig/debian/compat
+++ freenet6-1.0/debian/compat
@@ -0,0 +1 @@
+4
--- freenet6-1.0.orig/debian/freenet6.logcheck.ignore.server
+++ freenet6-1.0/debian/freenet6.logcheck.ignore.server
@@ -0,0 +1,14 @@
+TSPClient:  main: ----- TSP Client Version .* Initializing
+TSPClient:  main: tspc - Tunnel Server Protocol Client
+TSPClient:  main: Loading configuration file
+TSPClient:  main: Connecting to server
+TSPClient:  TryServer: Using \[.*\] as source IPv4 address\.
+TSPClient:  TryServer: Send request
+TSPClient:  TryServer: Request:
+TSPClient:  TryServer: <tunnel action="create"
+TSPClient:  ExtractPayload: Process response from server
+TSPClient:  ExtractPayload: Response: $
+TSPClient:  SetUpInterface: Executing configuration script\.
+TSPClient:  SetUpInterface: /etc/freenet6/template/
+TSPClient:  SetUpInterface:  $
+TSPClient:  main: Closing, exit status: 0
--- freenet6-1.0.orig/debian/changelog
+++ freenet6-1.0/debian/changelog
@@ -0,0 +1,101 @@
+freenet6 (1.0-2) unstable; urgency=low
+
+  * fix check in initscript, thanks Nelson Castillo (Closes: #221886)
+  * only send errors to system log.
+    that way we should get rid of multiline syslog entries (Closes: #214962)
+  * fix merge error in linux template
+
+ -- Martin Waitz <tali@debian.org>  Sun,  8 Feb 2004 01:44:54 +0100
+
+freenet6 (1.0-1) unstable; urgency=low
+
+  * New upstream release
+
+ -- Martin Waitz <tali@debian.org>  Thu,  9 Oct 2003 21:56:41 +0200
+
+freenet6 (0.9.9-2) unstable; urgency=low
+
+  * use debhelper v4
+    - use dh_installppp (Closes: #212833)
+    - use dh_installlogcheck
+  * clean up debian/{dirs,rules}
+
+ -- Martin Waitz <tali@debian.org>  Wed,  1 Oct 2003 23:07:38 +0200
+
+freenet6 (0.9.9-1) unstable; urgency=low
+
+  * New upstream release (Closes: #178917)
+    - uses new server by default (Closes: #200156)
+  * earlier setup on ip-up (Closes: #182038)
+  * Standards-Version 3.6.1.0
+
+ -- Martin Waitz <tali@debian.org>  Wed,  3 Sep 2003 23:27:17 +0200
+
+freenet6 (0.9.6-2) unstable; urgency=low
+
+  * Accept IPv6 DNS Servers for reverse lookups.
+    Thanks to David Fries. Closes: #151487
+  * Includes logcheck ignore file from Elmar Hoffmann,
+    Closes: #131857
+  * add ppp ip-down script stopping freenet6
+
+ -- Martin Waitz <tali@debian.org>  Tue,  2 Jul 2002 23:38:16 +0200
+
+freenet6 (0.9.6-1) unstable; urgency=low
+
+  * New upstream release
+
+ -- Martin Waitz <tali@debian.org>  Tue, 19 Mar 2002 13:00:09 +0100
+
+freenet6 (0.9.5-3) unstable; urgency=low
+
+  * debian/init.d: adjust for new location of config files
+
+ -- Martin Waitz <tali@debian.org>  Wed, 23 Jan 2002 11:43:11 +0100
+
+freenet6 (0.9.5-2) unstable; urgency=low
+
+  * debian/rules: move configuration files to /etc/freenet6, Closes: #126302
+  * debian/rules: manually create empty dirs to workaround cvs
+  * debian/control: reformat
+
+ -- Martin Waitz <tali@debian.org>  Sun,  6 Jan 2002 02:16:16 +0100
+
+freenet6 (0.9.5-1) unstable; urgency=low
+
+  * New upstream release
+
+ -- Martin Waitz <tali@debian.org>  Fri,  9 Nov 2001 12:04:52 +0100
+
+freenet6 (0.9.3-2) unstable; urgency=low
+
+  * disable radvd handling, it only causes problems, Closes: #116407
+  * document this fact in README.Debian
+  * redirect sysctl output to /dev/null
+  * debian/control: suggest radvd
+
+ -- Martin Waitz <tali@debian.org>  Thu, 25 Oct 2001 11:07:33 +0200
+
+freenet6 (0.9.3-1) unstable; urgency=low
+
+  * New upstream release
+    - fixes for PPC, Closes: #115770
+  * add a 2000::/3 route when configured for routing
+  * don't provide user when running radvd
+    i'm still not happy with the current radvd handling,
+    see Bug#116237,116251
+
+ -- Martin Waitz <tali@debian.org>  Fri, 19 Oct 2001 15:42:31 +0200
+
+freenet6 (0.9.2-2) unstable; urgency=low
+
+  * change function definitions to work with /bin/sh!=bash, Closes: #115530
+
+ -- Martin Waitz <tali@debian.org>  Sun, 14 Oct 2001 16:05:01 +0200
+
+freenet6 (0.9.2-1) unstable; urgency=low
+
+  * Initial Release, Closes: #112556
+
+ -- Martin Waitz <tali@debian.org>  Sat, 15 Sep 2001 13:26:56 +0200
+
--- freenet6-1.0.orig/debian/freenet6.0freenet6.ppp.ip-up
+++ freenet6-1.0/debian/freenet6.0freenet6.ppp.ip-up
@@ -0,0 +1,2 @@
+#!/bin/sh
+/etc/init.d/freenet6 restart
--- freenet6-1.0.orig/debian/copyright
+++ freenet6-1.0/debian/copyright
@@ -0,0 +1,498 @@
+This package was debianized by Martin Waitz <tali@debian.org> on
+Sat, 15 Sep 2001 13:26:56 +0200.
+
+It was downloaded from http://www.freenet6.net/download.shtml
+
+Upstream Author: Viagénie Inc.
+
+Copyright (c) 2001 Viagénie Inc.
+It may be distributed under the Viagénie Public License, see below.
+
+
+      Viagénie Public License 1.0 (VPL 1.0)
+
+      1. Definitions.
+
+           1.0.1. "Commercial Use" means distribution or otherwise
+           making the Covered Code available to a third party.
+
+           1.1. ''Contributor'' means each entity that creates or
+           contributes to the creation of Modifications.
+
+           1.2. ''Contributor Version'' means the combination of the
+           Original Code, prior Modifications used by a Contributor,
+           and the Modifications made by that particular Contributor.
+
+           1.3. ''Covered Code'' means the Original Code or
+           Modifications or the combination of the Original Code and
+           Modifications, in each case including portions thereof.
+
+           1.4. ''Electronic Distribution Mechanism'' means a
+           mechanism generally accepted in the software development
+           community for the electronic transfer of data.
+
+           1.5. ''Executable'' means Covered Code in any form other
+           than Source Code.
+
+           1.6. ''Initial Developer'' means the individual or entity
+           identified as the Initial Developer in the Source Code
+           notice required by Exhibit A.
+
+           1.7. ''Larger Work'' means a work which combines Covered
+           Code or portions thereof with code not governed by the
+           terms of this License.
+
+           1.8. ''License'' means this document.
+
+           1.8.1. "Licensable" means having the right to grant, to
+           the maximum extent possible, whether at the time of the
+           initial grant or subsequently acquired, any and all of the
+           rights conveyed herein.
+
+           1.9. ''Modifications'' means any addition to or deletion
+           from the substance or structure of either the Original
+           Code or any previous Modifications. When Covered Code is
+           released as a series of files, a Modification is:
+                A. Any addition to or deletion from the contents of a
+                file containing Original Code or previous
+                Modifications.
+
+                B. Any new file that contains any part of the
+                Original Code or previous Modifications.
+
+           1.10. ''Original Code'' means Source Code of computer
+           software code which is described in the Source Code notice
+           required by Exhibit A as Original Code, and which, at the
+           time of its release under this License is not already
+           Covered Code governed by this License.
+
+           1.10.1. "Patent Claims" means any patent claim(s), now
+           owned or hereafter acquired, including without
+           limitation,  method, process, and apparatus claims, in any
+           patent Licensable by grantor.
+
+           1.11. ''Source Code'' means the preferred form of the
+           Covered Code for making modifications to it, including all
+           modules it contains, plus any associated interface
+           definition files, scripts used to control compilation and
+           installation of an Executable, or source code differential
+           comparisons against either the Original Code or another
+           well known, available Covered Code of the Contributor's
+           choice. The Source Code can be in a compressed or archival
+           form, provided the appropriate decompression or
+           de-archiving software is widely available for no charge.
+
+           1.12. "You'' (or "Your")  means an individual or a legal
+           entity exercising rights under, and complying with all of
+           the terms of, this License or a future version of this
+           License issued under Section 6.1. For legal entities,
+           "You'' includes any entity which controls, is controlled
+           by, or is under common control with You. For purposes of
+           this definition, "control'' means (a) the power, direct or
+           indirect, to cause the direction or management of such
+           entity, whether by contract or otherwise, or (b) ownership
+           of more than fifty percent (50%) of the outstanding shares
+           or beneficial ownership of such entity.
+
+      2. Source Code License.
+
+           2.1. The Initial Developer Grant.
+           The Initial Developer hereby grants You a world-wide,
+           royalty-free, non-exclusive license, subject to third
+           party intellectual property claims:
+                (a) under intellectual property rights (other than
+                patent or trademark) Licensable by Initial Developer
+                to use, reproduce, modify, display, perform,
+                sublicense and distribute the Original Code (or
+                portions thereof) with or without Modifications,
+                and/or as part of a Larger Work; and
+
+                (b) under Patents Claims infringed by the making,
+                using or selling of Original Code, to make, have
+                made, use, practice, sell, and offer for sale, and/or
+                otherwise dispose of the Original Code (or portions
+                thereof).
+
+                (c) the licenses granted in this Section 2.1(a) and
+                (b) are effective on the date Initial Developer first
+                distributes Original Code under the terms of this
+                License.
+
+                (d) Notwithstanding Section 2.1(b) above, no patent
+                license is granted: 1) for code that You delete from
+                the Original Code; 2) separate from the Original
+                Code;  or 3) for infringements caused by: i) the
+                modification of the Original Code or ii) the
+                combination of the Original Code with other software
+                or devices.
+
+           2.2. Contributor Grant.
+           Subject to third party intellectual property claims, each
+           Contributor hereby grants You a world-wide, royalty-free,
+           non-exclusive license
+
+                (a) under intellectual property rights (other than
+                patent or trademark) Licensable by Contributor, to
+                use, reproduce, modify, display, perform, sublicense
+                and distribute the Modifications created by such
+                Contributor (or portions thereof) either on an
+                unmodified basis, with other Modifications, as
+                Covered Code and/or as part of a Larger Work; and
+
+                (b) under Patent Claims infringed by the making,
+                using, or selling of  Modifications made by that
+                Contributor either alone and/or in combination with
+                its Contributor Version (or portions of such
+                combination), to make, use, sell, offer for sale,
+                have made, and/or otherwise dispose of: 1)
+                Modifications made by that Contributor (or portions
+                thereof); and 2) the combination of  Modifications
+                made by that Contributor with its Contributor Version
+                (or portions of such combination).
+
+                (c) the licenses granted in Sections 2.2(a) and
+                2.2(b) are effective on the date Contributor first
+                makes Commercial Use of the Covered Code.
+
+                (d)    Notwithstanding Section 2.2(b) above, no
+                patent license is granted: 1) for any code that
+                Contributor has deleted from the Contributor Version;
+                2)  separate from the Contributor Version;  3)  for
+                infringements caused by: i) third party modifications
+                of Contributor Version or ii)  the combination of
+                Modifications made by that Contributor with other
+                software  (except as part of the Contributor Version)
+                or other devices; or 4) under Patent Claims infringed
+                by Covered Code in the absence of Modifications made
+                by that Contributor.
+
+      3. Distribution Obligations.
+
+           3.1. Application of License.
+           The Modifications which You create or to which You
+           contribute are governed by the terms of this License,
+           including without limitation Section 2.2. The Source Code
+           version of Covered Code may be distributed only under the
+           terms of this License or a future version of this License
+           released. You must include a copy of this License with
+           every copy of the Source Code You distribute. You may not
+           offer or impose any terms on any Source Code version that
+           alters or restricts the applicable version of this License
+           or the recipients' rights hereunder. However, You may
+           include an additional document offering the additional
+           rights described in Section 3.5.
+
+           3.2. Availability of Source Code.
+           Any Modification which You create or to which You
+           contribute must be made available in Source Code form
+           under the terms of this License either on the same media
+           as an Executable version or via an accepted Electronic
+           Distribution Mechanism to anyone to whom you made an
+           Executable version available; and if made available via
+           Electronic Distribution Mechanism, must remain available
+           for at least twelve (12) months after the date it
+           initially became available, or at least six (6) months
+           after a subsequent version of that particular Modification
+           has been made available to such recipients. You are
+           responsible for ensuring that the Source Code version
+           remains available even if the Electronic Distribution
+           Mechanism is maintained by a third party.
+
+           3.3. Description of Modifications.
+           You must cause all Covered Code to which You contribute to
+           contain a file documenting the changes You made to create
+           that Covered Code and the date of any change. You must
+           include a prominent statement that the Modification is
+           derived, directly or indirectly, from Original Code
+           provided by the Initial Developer and including the name
+           of the Initial Developer in (a) the Source Code, and (b)
+           in any notice in an Executable version or related
+           documentation in which You describe the origin or
+           ownership of the Covered Code.
+
+           3.4. Intellectual Property Matters
+                (a) Third Party Claims.
+                If Contributor has knowledge that a license under a
+                third party's intellectual property rights is
+                required to exercise the rights granted by such
+                Contributor under Sections 2.1 or 2.2, Contributor
+                must include a text file with the Source Code
+                distribution titled "LEGAL'' which describes the
+                claim and the party making the claim in sufficient
+                detail that a recipient will know whom to contact. If
+                Contributor obtains such knowledge after the
+                Modification is made available as described in
+                Section 3.2, Contributor shall promptly modify the
+                LEGAL file in all copies Contributor makes available
+                thereafter and shall take other steps (such as
+                notifying appropriate mailing lists or newsgroups)
+                reasonably calculated to inform those who received
+                the Covered Code that new knowledge has been
+                obtained.
+
+                (b) Contributor APIs.
+                If Contributor's Modifications include an application
+                programming interface and Contributor has knowledge
+                of patent licenses which are reasonably necessary to
+                implement that API, Contributor must also include
+                this information in the LEGAL file.
+
+                   (c)    Representations.
+                Contributor represents that, except as disclosed
+                pursuant to Section 3.4(a) above, Contributor
+                believes that Contributor's Modifications are
+                Contributor's original creation(s) and/or Contributor
+                has sufficient rights to grant the rights conveyed by
+                this License.
+
+           3.5. Required Notices.
+           You must duplicate the notice in Exhibit A in each file of
+           the Source Code.  If it is not possible to put such notice
+           in a particular Source Code file due to its structure,
+           then You must include such notice in a location (such as a
+           relevant directory) where a user would be likely to look
+           for such a notice.  If You created one or more
+           Modification(s) You may add your name as a Contributor to
+           the notice described in Exhibit A.  You must also
+           duplicate this License in any documentation for the Source
+           Code where You describe recipients' rights or ownership
+           rights relating to Covered Code.  You may choose to offer,
+           and to charge a fee for, warranty, support, indemnity or
+           liability obligations to one or more recipients of Covered
+           Code. However, You may do so only on Your own behalf, and
+           not on behalf of the Initial Developer or any Contributor.
+           You must make it absolutely clear than any such warranty,
+           support, indemnity or liability obligation is offered by
+           You alone, and You hereby agree to indemnify the Initial
+           Developer and every Contributor for any liability incurred
+           by the Initial Developer or such Contributor as a result
+           of warranty, support, indemnity or liability terms You
+           offer.
+
+           3.6. Distribution of Executable Versions.
+           You may distribute Covered Code in Executable form only if
+           the requirements of Section 3.1-3.5 have been met for that
+           Covered Code, and if You include a notice stating that the
+           Source Code version of the Covered Code is available under
+           the terms of this License, including a description of how
+           and where You have fulfilled the obligations of Section
+           3.2. The notice must be conspicuously included in any
+           notice in an Executable version, related documentation or
+           collateral in which You describe recipients' rights
+           relating to the Covered Code. You may distribute the
+           Executable version of Covered Code or ownership rights
+           under a license of Your choice, which may contain terms
+           different from this License, provided that You are in
+           compliance with the terms of this License and that the
+           license for the Executable version does not attempt to
+           limit or alter the recipient's rights in the Source Code
+           version from the rights set forth in this License. If You
+           distribute the Executable version under a different
+           license You must make it absolutely clear that any terms
+           which differ from this License are offered by You alone,
+           not by the Initial Developer or any Contributor. You
+           hereby agree to indemnify the Initial Developer and every
+           Contributor for any liability incurred by the Initial
+           Developer or such Contributor as a result of any such
+           terms You offer.
+
+           3.7. Larger Works.
+           You may create a Larger Work by combining Covered Code
+           with other code not governed by the terms of this License
+           and distribute the Larger Work as a single product. In
+           such a case, You must make sure the requirements of this
+           License are fulfilled for the Covered Code.
+
+      4. Inability to Comply Due to Statute or Regulation.
+
+           If it is impossible for You to comply with any of the
+           terms of this License with respect to some or all of the
+           Covered Code due to statute, judicial order, or regulation
+           then You must: (a) comply with the terms of this License
+           to the maximum extent possible; and (b) describe the
+           limitations and the code they affect. Such description
+           must be included in the LEGAL file described in Section
+           3.4 and must be included with all distributions of the
+           Source Code. Except to the extent prohibited by statute or
+           regulation, such description must be sufficiently detailed
+           for a recipient of ordinary skill to be able to understand
+           it.
+
+      5. Application of this License.
+
+           This License applies to code to which the Initial
+           Developer has attached the notice in Exhibit A and to
+           related Covered Code.
+
+      6. DISCLAIMER OF WARRANTY.
+
+           COVERED CODE IS PROVIDED UNDER THIS LICENSE ON AN "AS IS''
+           BASIS, WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR
+           IMPLIED, INCLUDING, WITHOUT LIMITATION, WARRANTIES THAT
+           THE COVERED CODE IS FREE OF DEFECTS, MERCHANTABLE, FIT FOR
+           A PARTICULAR PURPOSE OR NON-INFRINGING. THE ENTIRE RISK AS
+           TO THE QUALITY AND PERFORMANCE OF THE COVERED CODE IS WITH
+           YOU. SHOULD ANY COVERED CODE PROVE DEFECTIVE IN ANY
+           RESPECT, YOU (NOT THE INITIAL DEVELOPER OR ANY OTHER
+           CONTRIBUTOR) ASSUME THE COST OF ANY NECESSARY SERVICING,
+           REPAIR OR CORRECTION. THIS DISCLAIMER OF WARRANTY
+           CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO USE OF
+           ANY COVERED CODE IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS
+           DISCLAIMER.
+
+      7. TERMINATION.
+
+           7.1. This License and the rights granted hereunder will
+           terminate automatically if You fail to comply with terms
+           herein and fail to cure such breach within 30 days of
+           becoming aware of the breach. All sublicenses to the
+           Covered Code which are properly granted shall survive any
+           termination of this License. Provisions which, by their
+           nature, must remain in effect beyond the termination of
+           this License shall survive.
+
+           7.2. If You initiate litigation by asserting a patent
+           infringement claim (excluding declatory judgment actions)
+           against Initial Developer or a Contributor (the Initial
+           Developer or Contributor against whom You file such action
+           is referred to as "Participant")  alleging that:
+
+           (a) such Participant's Contributor Version directly or
+           indirectly infringes any patent, then any and all rights
+           granted by such Participant to You under Sections 2.1
+           and/or 2.2 of this License shall, upon 60 days notice from
+           Participant terminate prospectively, unless if within 60
+           days after receipt of notice You either: (i)  agree in
+           writing to pay Participant a mutually agreeable reasonable
+           royalty for Your past and future use of Modifications made
+           by such Participant, or (ii) withdraw Your litigation
+           claim with respect to the Contributor Version against such
+           Participant.  If within 60 days of notice, a reasonable
+           royalty and payment arrangement are not mutually agreed
+           upon in writing by the parties or the litigation claim is
+           not withdrawn, the rights granted by Participant to You
+           under Sections 2.1 and/or 2.2 automatically terminate at
+           the expiration of the 60 day notice period specified
+           above.
+
+           (b)  any software, hardware, or device, other than such
+           Participant's Contributor Version, directly or indirectly
+           infringes any patent, then any rights granted to You by
+           such Participant under Sections 2.1(b) and 2.2(b) are
+           revoked effective as of the date You first made, used,
+           sold, distributed, or had made, Modifications made by that
+           Participant.
+
+           7.3. If You assert a patent infringement claim against
+           Participant alleging that such Participant's Contributor
+           Version directly or indirectly infringes any patent where
+           such claim is resolved (such as by license or settlement)
+           prior to the initiation of patent infringement litigation,
+           then the reasonable value of the licenses granted by such
+           Participant under Sections 2.1 or 2.2 shall be taken into
+           account in determining the amount or value of any payment
+           or license.
+
+           7.4.  In the event of termination under Sections 7.1 or
+           7.2 above,  all end user license agreements (excluding
+           distributors and resellers) which have been validly
+           granted by You or any distributor hereunder prior to
+           termination shall survive termination.
+
+      8. LIMITATION OF LIABILITY.
+
+           UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER
+           TORT (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL
+           YOU, THE INITIAL DEVELOPER, ANY OTHER CONTRIBUTOR, OR ANY
+           DISTRIBUTOR OF COVERED CODE, OR ANY SUPPLIER OF ANY OF
+           SUCH PARTIES, BE LIABLE TO ANY PERSON FOR ANY INDIRECT,
+           SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY
+           CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS
+           OF GOODWILL, WORK STOPPAGE, COMPUTER FAILURE OR
+           MALFUNCTION, OR ANY AND ALL OTHER COMMERCIAL DAMAGES OR
+           LOSSES, EVEN IF SUCH PARTY SHALL HAVE BEEN INFORMED OF THE
+           POSSIBILITY OF SUCH DAMAGES. THIS LIMITATION OF LIABILITY
+           SHALL NOT APPLY TO LIABILITY FOR DEATH OR PERSONAL INJURY
+           RESULTING FROM SUCH PARTY'S NEGLIGENCE TO THE EXTENT
+           APPLICABLE LAW PROHIBITS SUCH LIMITATION. SOME
+           JURISDICTIONS DO NOT ALLOW THE EXCLUSION OR LIMITATION OF
+           INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THIS EXCLUSION AND
+           LIMITATION MAY NOT APPLY TO YOU.
+
+      9. MISCELLANEOUS.
+
+           This License represents the complete agreement concerning
+           subject matter hereof. If any provision of this License is
+           held to be unenforceable, such provision shall be reformed
+           only to the extent necessary to make it enforceable. This
+           License shall be governed and be construed by laws of the
+           Province of Quebec and the laws of Canada applicable
+           therein (except to the extent applicable law, if any,
+           provides otherwise), excluding its conflict-of-law
+           provisions. With respect to disputes in which at least one
+           party is a citizen of, or an entity chartered or
+           registered to do business in Canada, any litigation
+           relating to this License shall be subject to the
+           jurisdiction of the Federal Courts of the province of
+           Quebec, with venue lying in Quebec city, Quebec, with the
+           losing party responsible for costs, including without
+           limitation, court costs and reasonable attorneys' fees and
+           expenses. The application of the United Nations Convention
+           on Contracts for the International Sale of Goods is
+           expressly excluded. Any law or regulation which provides
+           that the language of a contract shall be construed against
+           the drafter shall not apply to this License. If any part
+           of this Agreement is found void and unenforceable, it will
+           not affect the validity of the balance of the Agreement,
+           which shall remain valid and enforceable according to its
+           terms.
+
+      10. RESPONSIBILITY FOR CLAIMS.
+
+           As between Initial Developer and the Contributors, each
+           party is responsible for claims and damages arising,
+           directly or indirectly, out of its utilization of rights
+           under this License and You agree to work with Initial
+           Developer and Contributors to distribute such
+           responsibility on an equitable basis. Nothing herein is
+           intended or shall be deemed to constitute any admission of
+           liability.
+
+      11. MULTIPLE-LICENSED CODE.
+
+           Initial Developer may designate portions of the Covered
+           Code as ?Multiple-Licensed?.  ?Multiple-Licensed? means
+           that the Initial Developer permits you to utilize portions
+           of the Covered Code under the VPL or the alternative
+           licenses, if any, specified by the Initial Developer in
+           the file described in Exhibit A.
+
+      12. LANGUAGE OF AGREEMENT.
+
+           You agree that this agreement be drafted in the English
+           language. Vous acceptez que cette convention soit rédigée
+           en anglais.
+
+      EXHIBIT A - Viagénie Public License.
+
+           ``The contents of this file are subject to the Viagénie
+           Public License Version 1.0 (the "License"); you may not
+           use this file except in compliance with the License. You
+           may obtain a copy of the License at
+           http://www.freenet6.net/VPL/
+
+           Software distributed under the License is distributed on
+           an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either
+           express or implied. See the License for the specific
+           language governing rights and limitations under the
+           License.
+
+           The Original Code is _source code of the tunnel server
+           protocol-client side_.
+
+           The Initial Developer of the Original Code is Viagénie .
+           Portions created by __________ are Copyright (C)
+           _________________________________.
+           All Rights Reserved.
+
+           Contributor(s): ______________________________________.
--- freenet6-1.0.orig/debian/rules
+++ freenet6-1.0/debian/rules
@@ -0,0 +1,79 @@
+#!/usr/bin/make -f
+# Sample debian/rules that uses debhelper.
+# GNU copyright 1997 to 1999 by Joey Hess.
+
+DESTDIR := $(CURDIR)/debian/freenet6
+
+
+build: build-stamp
+build-stamp:
+	dh_testdir
+
+	#
+	# Compiling...
+	#
+	# cvs doesn't preserve empty dirs
+	mkdir -p $(CURDIR)/bin
+	$(MAKE) all target=linux
+
+	touch build-stamp
+
+clean:
+	dh_testdir
+	dh_testroot
+	rm -f build-stamp
+
+	#
+	# Cleaning...
+	#
+	-$(MAKE) clean target=linux
+	rm -rf bin/*
+
+	dh_clean
+
+install: build
+	dh_testdir
+	dh_testroot
+	dh_clean -k
+	dh_installdirs
+
+	#
+	# Installing...
+	#
+	#$(MAKE) install DESTDIR=$(CURDIR)/debian/freenet6
+	install -m 755 bin/tspc $(DESTDIR)/usr/sbin/
+	install -m 600 bin/tspc.conf $(DESTDIR)/etc/freenet6/
+	install -m 755 template/linux.sh $(DESTDIR)/etc/freenet6/setup.sh
+	install -m 755 template/checktunnel.sh $(DESTDIR)/etc/freenet6/checktunnel.sh
+
+
+# Build architecture-independent files here.
+binary-indep: build install
+# We have nothing to do by default.
+
+# Build architecture-dependent files here.
+binary-arch: build install
+	dh_testdir
+	dh_testroot
+	#
+	# Packaging...
+	#
+	dh_installdocs
+	dh_installexamples
+	dh_installinit -r -- start 41 S . stop 35 0 6 .
+	dh_installman
+	dh_installchangelogs 
+	dh_installppp --name=0freenet6
+	dh_installlogcheck
+	dh_link
+	dh_strip
+	dh_compress
+	dh_fixperms
+	dh_installdeb
+	dh_shlibdeps
+	dh_gencontrol
+	dh_md5sums
+	dh_builddeb
+
+binary: binary-indep binary-arch
+.PHONY: build clean binary-indep binary-arch binary install configure
--- freenet6-1.0.orig/debian/manpages
+++ freenet6-1.0/debian/manpages
@@ -0,0 +1,3 @@
+man/man5/tspc.conf.5
+man/man8/tspc.8
+
--- freenet6-1.0.orig/debian/links
+++ freenet6-1.0/debian/links
@@ -0,0 +1,2 @@
+/etc/freenet6/setup.sh /etc/freenet6/linux.sh
+/etc/freenet6 /etc/freenet6/template
--- freenet6-1.0.orig/debian/README.Debian
+++ freenet6-1.0/debian/README.Debian
@@ -0,0 +1,10 @@
+When configured as router, freenet6 used to generate an own radvd.conf
+config file and to restart radvd with this configfile.
+This is bad when the user already specified a radvd configuration.
+
+Therefor, radvd handling in Debian's freenet6 is disabled.
+Please create your own router advertisement configuration in /etc/radvd.conf
+and everything is fine :)
+
+--
+Martin Waitz
--- freenet6-1.0.orig/debian/dirs
+++ freenet6-1.0/debian/dirs
@@ -0,0 +1,2 @@
+etc/freenet6
+usr/sbin
--- freenet6-1.0.orig/debian/control
+++ freenet6-1.0/debian/control
@@ -0,0 +1,23 @@
+Source: freenet6
+Section: net
+Priority: optional
+Maintainer: Martin Waitz <tali@debian.org>
+Build-Depends: debhelper (>= 4.1.68)
+Standards-Version: 3.5.9.0
+
+Package: freenet6
+Architecture: any
+Depends: ${shlibs:Depends}, net-tools, iproute
+Suggests: radvd
+Description: Client to configure an IPv6 tunnel to freenet6
+ Providing tspc, a Tunnel Server Protocol Client, this Package allows an easy
+ way to connect the machine to the 6bone.
+ .
+ Configured tunneling is a transition method standardized by IETF to use IPv6
+ in coexistence with IPv4 by encapsulating IPv6 packets over IPv4. Any host
+ already connected to Internet with IPv4 which has an IPv6 stack can establish
+ a link to the Internet IPv6.
+ .
+ FREENET6's TSP is a new model based on a client/server approach. A protocol is
+ used to request a single IPv6 address to a full IPv6 prefix from a client to a
+ tunnel server according to the IPv6 broker model.
--- freenet6-1.0.orig/debian/docs
+++ freenet6-1.0/debian/docs
@@ -0,0 +1,2 @@
+CONTRIB.txt
+README
