diff -urN shorewall-4.4.20.1.orig/configfiles/start shorewall-4.4.20.1/configfiles/start
--- shorewall-4.4.20.1.orig/configfiles/start	2011-06-07 01:08:29.000000000 +0200
+++ shorewall-4.4.20.1/configfiles/start	2011-06-07 17:03:51.679102163 +0200
@@ -10,4 +10,7 @@
 # information.
 #
 ###############################################################################
+for file in /etc/shorewall/start.d/* ; do
+    run_user_exit $file
+done
 return 0
diff -urN shorewall-4.4.20.1.orig/configfiles/stop shorewall-4.4.20.1/configfiles/stop
--- shorewall-4.4.20.1.orig/configfiles/stop	2011-06-07 01:08:29.000000000 +0200
+++ shorewall-4.4.20.1/configfiles/stop	2011-06-07 17:04:21.139595966 +0200
@@ -10,3 +10,6 @@
 # information.
 #
 ###############################################################################
+for file in /etc/shorewall/stop.d/* ; do
+    run_user_exit $file
+done
\ Kein Zeilenumbruch am Dateiende.
diff -urN shorewall-4.4.20.1.orig/init.debian.sh shorewall-4.4.20.1/init.debian.sh
--- shorewall-4.4.20.1.orig/init.debian.sh	2011-06-07 01:08:29.000000000 +0200
+++ shorewall-4.4.20.1/init.debian.sh	2011-06-07 17:05:02.507596116 +0200
@@ -1,70 +1,17 @@
 #!/bin/sh
-### BEGIN INIT INFO
-# Provides:          shorewall
-# Required-Start:    $network $remote_fs
-# Required-Stop:     $network $remote_fs
-# Default-Start:     S
-# Default-Stop:      0 6
-# Short-Description: Configure the firewall at boot time
-# Description:       Configure the firewall according to the rules specified in
-#                    /etc/shorewall
-### END INIT INFO
-
-
 
+RCDLINKS="2,S19 3,S19 4,S19 5,S19 0,K91 6,K91"
 SRWL=/sbin/shorewall
-SRWL_OPTS="-tvv"
-WAIT_FOR_IFUP=/usr/share/shorewall/wait4ifup
-test -n ${INITLOG:=/var/log/shorewall-init.log}
-
-test -x $SRWL || exit 0
-test -x $WAIT_FOR_IFUP || exit 0
-test -n "$INITLOG" || {
-	echo "INITLOG cannot be empty, please configure $0" ;
-	exit 1;
-}
+VERBOSE=
 
-if [ "$(id -u)" != "0" ]
-then
-  echo "You must be root to start, stop or restart \"Shorewall firewall\"."
-  exit 1
-fi
-
-echo_notdone () {
-
-  if [ "$INITLOG" = "/dev/null" ] ; then
-	  echo "not done."
-  else
-	  echo "not done (check $INITLOG)."
-  fi
+WAIT_FOR_IFUP=/usr/share/shorewall/wait4ifup
 
-  exit 1
-}
+# parse the shorewall params file in order to use params in                                                               
+# /etc/default/shorewall
 
-not_configured () {
-	echo "#### WARNING ####"
-	echo "The firewall won't be started/stopped unless it is configured"
-	if [ "$1" != "stop" ]
-	then
-		echo ""
-		echo "Please read about Debian specific customization in"
-		echo "/usr/share/doc/shorewall/README.Debian.gz."
-	fi
-	echo "#################"
-	exit 0
-}
-
-# check if shorewall is configured or not
 if [ -f "/etc/default/shorewall" ]
 then
 	. /etc/default/shorewall
-	SRWL_OPTS="$SRWL_OPTS $OPTIONS"
-	if [ "$startup" != "1" ]
-	then
-		not_configured
-	fi
-else
-	not_configured
 fi
 
 [ "$INITLOG" = "/dev/null" ] && SHOREWALL_INIT_SCRIPT=1 || SHOREWALL_INIT_SCRIPT=0
@@ -75,10 +22,16 @@
 wait_for_pppd () {
 	if [ "$wait_interface" != "" ]
 	then
-		for i in $wait_interface
-		do
-			$WAIT_FOR_IFUP $i 90
-		done
+		if [ -f $WAIT_FOR_IFUP ]
+		then	
+			for i in $wait_interface
+			do
+				$WAIT_FOR_IFUP $i 90
+			done
+		else
+			echo "$WAIT_FOR_IFUP: File not found"
+			exit 2
+		fi		
 	fi
 }
 
@@ -86,7 +39,7 @@
 shorewall_start () {
   echo -n "Starting \"Shorewall firewall\": "
   wait_for_pppd
-  $SRWL $SRWL_OPTS start >> $INITLOG 2>&1 && echo "done." || echo_notdone
+  $SRWL $OPTIONS start 2>&1 && echo "done."
   return 0
 }
 
@@ -94,9 +47,9 @@
 shorewall_stop () {
   echo -n "Stopping \"Shorewall firewall\": "
   if [ "$SAFESTOP" = 1 ]; then
-      $SRWL $SRWL_OPTS stop >> $INITLOG 2>&1 && echo "done." || echo_notdone
+      $SRWL $OPTIONS stop 2>&1 && echo "done."
   else
-      $SRWL $SRWL_OPTS clear >> $INITLOG 2>&1 && echo "done." || echo_notdone
+      $SRWL $OPTIONS clear 2>&1 && echo "done."
   fi
   return 0
 }
@@ -104,14 +57,14 @@
 # restart the firewall
 shorewall_restart () {
   echo -n "Restarting \"Shorewall firewall\": "
-  $SRWL $SRWL_OPTS restart >> $INITLOG 2>&1 && echo "done." || echo_notdone
+  $SRWL $OPTIONS restart 2>&1 && echo "done."
   return 0
 }
 
 # refresh the firewall
 shorewall_refresh () {
   echo -n "Refreshing \"Shorewall firewall\": "
-  $SRWL $SRWL_OPTS refresh >> $INITLOG 2>&1 && echo "done." || echo_notdone
+  $SRWL $OPTIONS refresh 2>&1 && echo "done."
   return 0
 }
 
diff -urN shorewall-4.4.20.1.orig/configfiles/shorewall.conf shorewall-4.4.20.1/configfiles/shorewall.conf
--- shorewall-4.4.20.1.orig/configfiles/shorewall.conf	2011-06-07 01:08:29.000000000 +0200
+++ shorewall-4.4.20.1/configfiles/shorewall.conf	2011-06-07 17:06:51.679102156 +0200
@@ -9,7 +9,7 @@
 #		       S T A R T U P   E N A B L E D
 ###############################################################################
 
-STARTUP_ENABLED=No
+STARTUP_ENABLED=Yes
 
 ###############################################################################
 #		              V E R B O S I T Y
@@ -31,7 +31,7 @@
 
 LOGBURST=
 
-LOGFILE=/var/log/messages
+LOGFILE=/var/log/shorewall.log
 
 LOGFORMAT="Shorewall:%s:%s:"
 
@@ -63,7 +63,7 @@
 
 IPSET=
 
-MODULESDIR=
+MODULESDIR=/lib/modules
 
 PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin:/usr/local/sbin
 
@@ -73,7 +73,7 @@
 
 SHOREWALL_SHELL=/bin/sh
 
-SUBSYSLOCK=/var/lock/subsys/shorewall
+SUBSYSLOCK=/var/run/shorewall
 
 TC=
 
@@ -124,7 +124,7 @@
 
 DETECT_DNAT_IPADDRS=No
 
-DISABLE_IPV6=No
+DISABLE_IPV6=Yes
 
 DONT_LOAD=
 
