diff -urN oprofile-0.9.8.orig/daemon/liblegacy/p_module.h oprofile-0.9.8/daemon/liblegacy/p_module.h
--- oprofile-0.9.8.orig/daemon/liblegacy/p_module.h	2012-08-27 20:59:13.000000000 +0200
+++ oprofile-0.9.8/daemon/liblegacy/p_module.h	2012-11-24 12:30:30.401632428 +0100
@@ -182,7 +182,8 @@
 #define NEW_MOD_INITIALIZING	64
 
 int sys_init_module(char const * name, const struct module *);
-int query_module(char const * name, int which, void *buf, size_t bufsize,
+int __attribute__((weak))
+query_module(char const * name, int which, void *buf, size_t bufsize,
 		 size_t *ret);
 
 /* Values for query_module's which.  */
